// Silvaniya E-commerce Database Schema
// Prisma Schema for PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// ADMIN USERS & RBAC
// ============================================================================

model AdminUser {
  id            String    @id @default(cuid())
  email         String    @unique
  passwordHash  String    @map("password_hash")
  firstName     String    @map("first_name")
  lastName      String    @map("last_name")
  phone         String?
  avatar        String?
  role          AdminRole @default(VIEWER)
  isActive      Boolean   @default(true) @map("is_active")
  lastLoginAt   DateTime? @map("last_login_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  auditLogs     AuditLog[]

  @@map("admin_users")
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  MANAGER
  VIEWER
}

model AuditLog {
  id          String   @id @default(cuid())
  adminUserId String   @map("admin_user_id")
  action      String   // CREATE, UPDATE, DELETE
  entity      String   // Product, Order, etc.
  entityId    String   @map("entity_id")
  oldData     Json?    @map("old_data")
  newData     Json?    @map("new_data")
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent")
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  adminUser   AdminUser @relation(fields: [adminUserId], references: [id])

  @@index([adminUserId])
  @@index([entity, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

// ============================================================================
// CUSTOMER USERS
// ============================================================================

model User {
  id            String    @id @default(cuid())
  email         String?   @unique
  phone         String?   @unique
  firstName     String?   @map("first_name")
  lastName      String?   @map("last_name")
  isVerified    Boolean   @default(false) @map("is_verified")
  isActive      Boolean   @default(true) @map("is_active")
  lastLoginAt   DateTime? @map("last_login_at")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  addresses     Address[]
  orders        Order[]
  reviews       Review[]
  wishlistItems WishlistItem[]
  cart          Cart?

  @@map("users")
}

model Address {
  id            String   @id @default(cuid())
  userId        String   @map("user_id")
  label         String?  // Home, Office, etc.
  firstName     String   @map("first_name")
  lastName      String   @map("last_name")
  phone         String
  addressLine1  String   @map("address_line_1")
  addressLine2  String?  @map("address_line_2")
  city          String
  state         String
  pincode       String
  country       String   @default("India")
  isDefault     Boolean  @default(false) @map("is_default")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders        Order[]  @relation("ShippingAddress")

  @@index([userId])
  @@map("addresses")
}

model OtpVerification {
  id        String   @id @default(cuid())
  target    String   // phone or email
  otp       String
  expiresAt DateTime @map("expires_at")
  attempts  Int      @default(0)
  verified  Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  @@index([target, otp])
  @@map("otp_verifications")
}

// ============================================================================
// PRODUCT CATALOG
// ============================================================================

model Category {
  id            String     @id @default(cuid())
  name          String
  slug          String     @unique
  description   String?
  image         String?
  parentId      String?    @map("parent_id")
  sortOrder     Int        @default(0) @map("sort_order")
  isFeatured    Boolean    @default(false) @map("is_featured")
  isActive      Boolean    @default(true) @map("is_active")
  metaTitle     String?    @map("meta_title")
  metaDesc      String?    @map("meta_description")
  createdAt     DateTime   @default(now()) @map("created_at")
  updatedAt     DateTime   @updatedAt @map("updated_at")

  // Self-relation for hierarchy
  parent        Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children      Category[] @relation("CategoryHierarchy")

  // Relations
  products      ProductCategory[]

  @@index([slug])
  @@index([parentId])
  @@map("categories")
}

model Product {
  id              String    @id @default(cuid())
  name            String
  slug            String    @unique
  shortDesc       String?   @map("short_description")
  description     String?   @db.Text
  basePrice       Decimal   @map("base_price") @db.Decimal(10, 2)
  compareAtPrice  Decimal?  @map("compare_at_price") @db.Decimal(10, 2)
  costPrice       Decimal?  @map("cost_price") @db.Decimal(10, 2)
  sku             String?   @unique
  barcode         String?
  weight          Decimal?  @db.Decimal(8, 3) // in grams
  purity          String    @default("925") // 925 Sterling Silver
  isActive        Boolean   @default(true) @map("is_active")
  isFeatured      Boolean   @default(false) @map("is_featured")
  isNew           Boolean   @default(true) @map("is_new")
  metaTitle       String?   @map("meta_title")
  metaDesc        String?   @map("meta_description")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  categories      ProductCategory[]
  variants        ProductVariant[]
  images          ProductImage[]
  reviews         Review[]
  wishlistItems   WishlistItem[]
  collections     CollectionProduct[]

  @@index([slug])
  @@index([isActive, isFeatured])
  @@index([createdAt])
  @@map("products")
}

model ProductCategory {
  productId   String   @map("product_id")
  categoryId  String   @map("category_id")
  createdAt   DateTime @default(now()) @map("created_at")

  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@id([productId, categoryId])
  @@map("product_categories")
}

model ProductVariant {
  id            String   @id @default(cuid())
  productId     String   @map("product_id")
  sku           String   @unique
  name          String   // e.g., "Size 6 / 5g"
  price         Decimal  @db.Decimal(10, 2)
  comparePrice  Decimal? @map("compare_at_price") @db.Decimal(10, 2)
  costPrice     Decimal? @map("cost_price") @db.Decimal(10, 2)
  weight        Decimal? @db.Decimal(8, 3) // in grams
  stock         Int      @default(0)
  lowStockThreshold Int  @default(5) @map("low_stock_threshold")
  isActive      Boolean  @default(true) @map("is_active")
  sortOrder     Int      @default(0) @map("sort_order")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  product       Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  attributes    VariantAttribute[]
  cartItems     CartItem[]
  orderItems    OrderItem[]
  stockLogs     StockLog[]

  @@index([productId])
  @@index([sku])
  @@map("product_variants")
}

model AttributeType {
  id          String      @id @default(cuid())
  name        String      @unique // Size, Weight, Stone
  displayName String      @map("display_name")
  sortOrder   Int         @default(0) @map("sort_order")
  createdAt   DateTime    @default(now()) @map("created_at")

  // Relations
  values      AttributeValue[]

  @@map("attribute_types")
}

model AttributeValue {
  id              String    @id @default(cuid())
  attributeTypeId String    @map("attribute_type_id")
  value           String    // "6", "7", "5g", "10g", "Amethyst"
  displayValue    String    @map("display_value")
  sortOrder       Int       @default(0) @map("sort_order")
  createdAt       DateTime  @default(now()) @map("created_at")

  // Relations
  attributeType   AttributeType @relation(fields: [attributeTypeId], references: [id])
  variantAttributes VariantAttribute[]

  @@unique([attributeTypeId, value])
  @@map("attribute_values")
}

model VariantAttribute {
  variantId        String @map("variant_id")
  attributeValueId String @map("attribute_value_id")

  variant          ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  attributeValue   AttributeValue @relation(fields: [attributeValueId], references: [id])

  @@id([variantId, attributeValueId])
  @@map("variant_attributes")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String   @map("product_id")
  url       String
  alt       String?
  sortOrder Int      @default(0) @map("sort_order")
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")

  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@map("product_images")
}

model StockLog {
  id          String   @id @default(cuid())
  variantId   String   @map("variant_id")
  quantity    Int      // positive for increase, negative for decrease
  reason      String   // SALE, RESTOCK, ADJUSTMENT, RETURN
  reference   String?  // Order ID, etc.
  notes       String?
  createdBy   String?  @map("created_by") // Admin user ID
  createdAt   DateTime @default(now()) @map("created_at")

  variant     ProductVariant @relation(fields: [variantId], references: [id])

  @@index([variantId])
  @@index([createdAt])
  @@map("stock_logs")
}

// ============================================================================
// COLLECTIONS (Curated groups)
// ============================================================================

model Collection {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  image       String?
  isActive    Boolean   @default(true) @map("is_active")
  isFeatured  Boolean   @default(false) @map("is_featured")
  sortOrder   Int       @default(0) @map("sort_order")
  metaTitle   String?   @map("meta_title")
  metaDesc    String?   @map("meta_description")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  products    CollectionProduct[]

  @@map("collections")
}

model CollectionProduct {
  collectionId String   @map("collection_id")
  productId    String   @map("product_id")
  sortOrder    Int      @default(0) @map("sort_order")
  createdAt    DateTime @default(now()) @map("created_at")

  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  product      Product    @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([collectionId, productId])
  @@map("collection_products")
}

// ============================================================================
// CART
// ============================================================================

model Cart {
  id          String     @id @default(cuid())
  userId      String?    @unique @map("user_id")
  sessionId   String?    @unique @map("session_id") // For guest carts
  couponId    String?    @map("coupon_id")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  expiresAt   DateTime?  @map("expires_at")

  // Relations
  user        User?      @relation(fields: [userId], references: [id], onDelete: Cascade)
  coupon      Coupon?    @relation(fields: [couponId], references: [id])
  items       CartItem[]

  @@index([sessionId])
  @@map("carts")
}

model CartItem {
  id          String   @id @default(cuid())
  cartId      String   @map("cart_id")
  variantId   String   @map("variant_id")
  quantity    Int      @default(1)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  cart        Cart           @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant     ProductVariant @relation(fields: [variantId], references: [id])

  @@unique([cartId, variantId])
  @@map("cart_items")
}

// ============================================================================
// ORDERS
// ============================================================================

model Order {
  id                String        @id @default(cuid())
  orderNumber       String        @unique @map("order_number") // SIL-20260107-XXXX
  userId            String?       @map("user_id")
  guestEmail        String?       @map("guest_email")
  guestPhone        String?       @map("guest_phone")
  status            OrderStatus   @default(PENDING)

  // Pricing
  subtotal          Decimal       @db.Decimal(10, 2)
  discount          Decimal       @default(0) @db.Decimal(10, 2)
  shippingCost      Decimal       @default(0) @map("shipping_cost") @db.Decimal(10, 2)
  tax               Decimal       @default(0) @db.Decimal(10, 2)
  total             Decimal       @db.Decimal(10, 2)

  // Coupon
  couponId          String?       @map("coupon_id")
  couponCode        String?       @map("coupon_code")

  // Shipping Address (denormalized)
  shippingAddressId String?       @map("shipping_address_id")
  shippingName      String        @map("shipping_name")
  shippingPhone     String        @map("shipping_phone")
  shippingLine1     String        @map("shipping_line_1")
  shippingLine2     String?       @map("shipping_line_2")
  shippingCity      String        @map("shipping_city")
  shippingState     String        @map("shipping_state")
  shippingPincode   String        @map("shipping_pincode")
  shippingCountry   String        @default("India") @map("shipping_country")

  // Shipping Info
  shippingMethod    String?       @map("shipping_method")
  awbNumber         String?       @map("awb_number") // Air Waybill
  trackingUrl       String?       @map("tracking_url")
  shippedAt         DateTime?     @map("shipped_at")
  deliveredAt       DateTime?     @map("delivered_at")

  // Notes
  customerNote      String?       @map("customer_note")
  adminNote         String?       @map("admin_note")

  // Timestamps
  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")
  cancelledAt       DateTime?     @map("cancelled_at")
  completedAt       DateTime?     @map("completed_at")

  // Relations
  user              User?         @relation(fields: [userId], references: [id])
  shippingAddress   Address?      @relation("ShippingAddress", fields: [shippingAddressId], references: [id])
  coupon            Coupon?       @relation(fields: [couponId], references: [id])
  items             OrderItem[]
  payments          Payment[]
  returns           Return[]
  timeline          OrderTimeline[]

  @@index([userId])
  @@index([orderNumber])
  @@index([status])
  @@index([createdAt])
  @@map("orders")
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  COMPLETED
  CANCELLED
  RETURN_REQUESTED
  RETURNED
  REFUNDED
}

model OrderItem {
  id            String   @id @default(cuid())
  orderId       String   @map("order_id")
  variantId     String   @map("variant_id")
  productName   String   @map("product_name")
  variantName   String   @map("variant_name")
  sku           String
  quantity      Int
  unitPrice     Decimal  @map("unit_price") @db.Decimal(10, 2)
  totalPrice    Decimal  @map("total_price") @db.Decimal(10, 2)
  productImage  String?  @map("product_image")
  createdAt     DateTime @default(now()) @map("created_at")

  order         Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  variant       ProductVariant @relation(fields: [variantId], references: [id])

  @@index([orderId])
  @@map("order_items")
}

model OrderTimeline {
  id        String   @id @default(cuid())
  orderId   String   @map("order_id")
  status    String
  message   String
  createdBy String?  @map("created_by") // Admin ID or "system"
  createdAt DateTime @default(now()) @map("created_at")

  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@map("order_timeline")
}

// ============================================================================
// PAYMENTS (Razorpay)
// ============================================================================

model Payment {
  id                String        @id @default(cuid())
  orderId           String        @map("order_id")
  method            PaymentMethod
  status            PaymentStatus @default(PENDING)
  amount            Decimal       @db.Decimal(10, 2)
  currency          String        @default("INR")

  // Razorpay fields
  razorpayOrderId   String?       @unique @map("razorpay_order_id")
  razorpayPaymentId String?       @unique @map("razorpay_payment_id")
  razorpaySignature String?       @map("razorpay_signature")

  // COD
  codAdvance        Decimal?      @map("cod_advance") @db.Decimal(10, 2)
  codAdvancePaymentId String?     @map("cod_advance_payment_id")

  // Refund
  refundId          String?       @map("refund_id")
  refundAmount      Decimal?      @map("refund_amount") @db.Decimal(10, 2)
  refundedAt        DateTime?     @map("refunded_at")

  // Metadata
  errorCode         String?       @map("error_code")
  errorMessage      String?       @map("error_message")
  metadata          Json?

  createdAt         DateTime      @default(now()) @map("created_at")
  updatedAt         DateTime      @updatedAt @map("updated_at")

  order             Order         @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([razorpayOrderId])
  @@index([razorpayPaymentId])
  @@map("payments")
}

enum PaymentMethod {
  RAZORPAY      // Card, UPI, NetBanking, Wallet
  COD           // Cash on Delivery
}

enum PaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
  COD_ADVANCE_PAID
  COD_PENDING
  COD_COLLECTED
}

// ============================================================================
// RETURNS & REFUNDS
// ============================================================================

model Return {
  id              String       @id @default(cuid())
  orderId         String       @map("order_id")
  status          ReturnStatus @default(REQUESTED)
  reason          String
  customerNote    String?      @map("customer_note")
  adminNote       String?      @map("admin_note")
  unboxingVideoUrl String?     @map("unboxing_video_url")
  refundAmount    Decimal?     @map("refund_amount") @db.Decimal(10, 2)
  refundedAt      DateTime?    @map("refunded_at")
  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")

  order           Order        @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@map("returns")
}

enum ReturnStatus {
  REQUESTED
  APPROVED
  REJECTED
  SHIPPED_BACK
  RECEIVED
  INSPECTING
  REFUND_INITIATED
  COMPLETED
}

// ============================================================================
// COUPONS
// ============================================================================

model Coupon {
  id              String     @id @default(cuid())
  code            String     @unique
  description     String?
  type            CouponType
  value           Decimal    @db.Decimal(10, 2) // percentage or fixed amount
  minOrderValue   Decimal?   @map("min_order_value") @db.Decimal(10, 2)
  maxDiscount     Decimal?   @map("max_discount") @db.Decimal(10, 2) // cap for percentage
  usageLimit      Int?       @map("usage_limit")
  usageCount      Int        @default(0) @map("usage_count")
  perUserLimit    Int?       @map("per_user_limit")
  validFrom       DateTime   @map("valid_from")
  validUntil      DateTime   @map("valid_until")
  isActive        Boolean    @default(true) @map("is_active")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")

  // Relations
  carts           Cart[]
  orders          Order[]
  usages          CouponUsage[]
  applicableCategories CouponCategory[]
  applicableProducts   CouponProduct[]

  @@index([code])
  @@map("coupons")
}

enum CouponType {
  PERCENTAGE
  FIXED_AMOUNT
}

model CouponUsage {
  id        String   @id @default(cuid())
  couponId  String   @map("coupon_id")
  userId    String?  @map("user_id")
  orderId   String   @map("order_id")
  discount  Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now()) @map("created_at")

  coupon    Coupon   @relation(fields: [couponId], references: [id])

  @@index([couponId, userId])
  @@map("coupon_usages")
}

model CouponCategory {
  couponId   String @map("coupon_id")
  categoryId String @map("category_id")

  coupon     Coupon @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@id([couponId, categoryId])
  @@map("coupon_categories")
}

model CouponProduct {
  couponId  String @map("coupon_id")
  productId String @map("product_id")

  coupon    Coupon @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@id([couponId, productId])
  @@map("coupon_products")
}

// ============================================================================
// REVIEWS
// ============================================================================

model Review {
  id          String       @id @default(cuid())
  productId   String       @map("product_id")
  userId      String       @map("user_id")
  rating      Int          // 1-5
  title       String?
  comment     String?      @db.Text
  images      String[]     // Array of image URLs
  status      ReviewStatus @default(PENDING)
  isVerified  Boolean      @default(false) @map("is_verified") // Verified purchase
  helpfulCount Int         @default(0) @map("helpful_count")
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")

  product     Product      @relation(fields: [productId], references: [id], onDelete: Cascade)
  user        User         @relation(fields: [userId], references: [id])

  @@unique([productId, userId])
  @@index([productId, status])
  @@map("reviews")
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

// ============================================================================
// WISHLIST
// ============================================================================

model WishlistItem {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  productId String   @map("product_id")
  createdAt DateTime @default(now()) @map("created_at")

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

// ============================================================================
// CMS - BANNERS
// ============================================================================

model Banner {
  id          String   @id @default(cuid())
  title       String
  subtitle    String?
  image       String
  mobileImage String?  @map("mobile_image")
  link        String?
  position    String   @default("home_hero") // home_hero, home_middle, category_top
  sortOrder   Int      @default(0) @map("sort_order")
  isActive    Boolean  @default(true) @map("is_active")
  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([position, isActive])
  @@map("banners")
}

// ============================================================================
// CMS - BLOG
// ============================================================================

model BlogPost {
  id            String   @id @default(cuid())
  title         String
  slug          String   @unique
  excerpt       String?
  content       String   @db.Text
  featuredImage String?  @map("featured_image")
  author        String?
  tags          String[] // Array of tags
  isPublished   Boolean  @default(false) @map("is_published")
  publishedAt   DateTime? @map("published_at")
  metaTitle     String?  @map("meta_title")
  metaDesc      String?  @map("meta_description")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@index([slug])
  @@index([isPublished, publishedAt])
  @@map("blog_posts")
}

// ============================================================================
// CMS - STATIC PAGES
// ============================================================================

model Page {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  content     String   @db.Text
  metaTitle   String?  @map("meta_title")
  metaDesc    String?  @map("meta_description")
  isPublished Boolean  @default(true) @map("is_published")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("pages")
}

// ============================================================================
// SETTINGS
// ============================================================================

model Setting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     Json
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("settings")
}

// ============================================================================
// NEWSLETTER SUBSCRIBERS
// ============================================================================

model NewsletterSubscriber {
  id            String   @id @default(cuid())
  email         String   @unique
  isSubscribed  Boolean  @default(true) @map("is_subscribed")
  subscribedAt  DateTime @default(now()) @map("subscribed_at")
  unsubscribedAt DateTime? @map("unsubscribed_at")

  @@map("newsletter_subscribers")
}

// ============================================================================
// CONTACT FORM SUBMISSIONS
// ============================================================================

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String?
  message   String   @db.Text
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("contact_submissions")
}

// ============================================================================
// VENDOR MARKETPLACE - EXTERNAL JEWELLERY LISTINGS
// ============================================================================

model Vendor {
  id            String   @id @default(cuid())
  name          String
  slug          String   @unique
  description   String?  @db.Text
  logo          String?
  website       String?
  email         String?
  phone         String?
  address       String?  @db.Text
  city          String?
  state         String?
  pincode       String?
  isActive      Boolean  @default(true) @map("is_active")
  isFeatured    Boolean  @default(false) @map("is_featured")
  commission    Decimal  @default(0) @db.Decimal(5, 2) // Commission percentage
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  // Relations
  products      VendorProduct[]

  @@index([slug])
  @@index([isActive, isFeatured])
  @@map("vendors")
}

model VendorProduct {
  id              String    @id @default(cuid())
  vendorId        String    @map("vendor_id")
  name            String
  slug            String    @unique
  description     String?   @db.Text
  price           Decimal   @db.Decimal(10, 2)
  compareAtPrice  Decimal?  @map("compare_at_price") @db.Decimal(10, 2)
  image           String?
  images          String[]  // Array of image URLs
  category        String?   // Category name/slug
  externalUrl     String?   @map("external_url") // Link to vendor's product page
  purity          String?   @default("925")
  weight          Decimal?  @db.Decimal(8, 3) // in grams
  isActive        Boolean   @default(true) @map("is_active")
  isFeatured      Boolean   @default(false) @map("is_featured")
  inStock         Boolean   @default(true) @map("in_stock")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  vendor          Vendor    @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@index([slug])
  @@index([isActive, isFeatured])
  @@index([category])
  @@map("vendor_products")
}
